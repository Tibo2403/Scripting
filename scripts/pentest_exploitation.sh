#!/bin/bash
# pentest_exploitation.sh - Phase d'exploitation (facultative)
# À utiliser uniquement avec l'accord explicite de la cible
set -euo pipefail

if ! command -v nmap >/dev/null 2>&1; then
    echo "Erreur: nmap n'est pas installé." >&2
    exit 1
fi

RESULTS_DIR="pentest_results_latest"

usage() {
    echo "Usage: $0 [-d results_dir]" >&2
}

while getopts "d:h" opt; do
    case $opt in
        d) RESULTS_DIR="$OPTARG";;
        h) usage; exit 0;;
        *) usage; exit 1;;
    esac
done

if [[ ! -d "$RESULTS_DIR" ]]; then
    echo "Dossier $RESULTS_DIR introuvable" >&2
    exit 1
fi

for xml in "$RESULTS_DIR"/*_vuln.xml; do
    [[ ! -f "$xml" ]] && continue
    host=$(basename "$xml" _vuln.xml)
    echo "[+] Phase d'exploitation pour $host"
    echo "    -> Ici, ajoutez vos commandes d'exploitation (Metasploit, scripts)"
done

echo "✅ Exploitation terminée (si configurée)"
