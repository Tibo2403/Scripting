#!/bin/bash
# pentest_verification.sh - Phase de v√©rification des vuln√©rabilit√©s
set -euo pipefail

OUTPUT_DIR="pentest_results"
RESULTS_DIR="$OUTPUT_DIR"

if [[ ! -d "$RESULTS_DIR" ]]; then
    echo "Dossier $RESULTS_DIR introuvable" >&2
    exit 1
fi

for xml in "$RESULTS_DIR"/*_discovery.xml; do
    [[ ! -f "$xml" ]] && continue
    host=$(basename "$xml" _discovery.xml)
    echo "[+] Tests de vuln√©rabilit√© pour $host"
    nmap --script vuln -oX "$RESULTS_DIR/${host}_vuln.xml" "$host"
done

echo "üìÑ R√©sultats des vuln√©rabilit√©s enregistr√©s dans $RESULTS_DIR/"
